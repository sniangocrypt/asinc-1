import requests
import asyncio
from aiohttp import ClientSession
from collections import OrderedDict
import time
import random
import json
import aiofiles

dict = ["BTC", "ETH", "SOL"]
#symbol = f"BTC"


async def get_okx_info():
    async with ClientSession() as session:
        url = f'https://www.okx.com/api/v5/market/tickers?instType=SPOT'
        headers = {
            'Accept': 'application/json',
        }
        async with session.get(url=url, headers=headers) as response:
            data = await response.json()
        okx = []
        for ticker in data['data']:
            if ticker['instId'][-5:] == "-USDT":
                okx.append(ticker)
#                print(okx)
        async with aiofiles.open('okxbook.json', 'w') as file:
            await file.write(json.dumps(okx, indent=4))

async def get_binance_info():
    async with ClientSession() as session:
        url = f'https://api.binance.com/api/v3/ticker/price'
        headers = {
            'Accept': 'application/json',
        }
        async with session.get(url=url, headers=headers) as response:
            data = await response.json()
            binance = []
            for ticker in data:
                if ticker['symbol'][-4:] == "USDT":
                    binance.append(ticker)
#                    print(binance)
        async with aiofiles.open('binancebook.json', 'w') as file:
            await file.write(json.dumps(binance, indent=4))



async def get_bybit_info():
    async with ClientSession() as session:
        url = f'https://api.bybit.com/v5/market/tickers?category=spot'
        headers = {
            'Accept': 'application/json',
        }
        async with session.get(url=url, headers=headers) as response:
            data = await response.json()
            bybit = []
            for ticker in data['result']['list']:
                if ticker['symbol'][-4:] == "USDT":
                    bybit.append(ticker)
#                    print(bybit)
        async with aiofiles.open('bybitbook.json', 'w') as file:
            await file.write(json.dumps(bybit, indent=4))


async def main():
    tasks = [get_okx_info(),get_binance_info(),get_bybit_info()]
    await asyncio.gather(*tasks)




#get_order_book(symbol=f"ETH")

print("Start Time:", time.strftime('%X'))
asyncio.run(main())
print("End Time:", time.strftime('%X'))
